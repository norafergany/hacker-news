import { renderHook } from "@testing-library/react-hooks";
import MockAdapter from "axios-mock-adapter";
import useGetStories from "./getStories";
import {act} from "@testing-library/react";
import getStories from "./getStories";
import { render, waitFor } from "@testing-library/react";
import axios from "axios";
import ArticleList from "../components/ArticleList";


test("useFetch performs GET request", async () => {
    // const initialValue = {};
    // const mock = new MockAdapter(axios);

    const mockData = [
                {
                    "by": "syrusakbary",
                    "descendants": 50,
                    "id": 33721685,
                    "kids": [
                        33723071,
                        33722645,
                        33722681,
                        33723797,
                        33723191,
                        33723869,
                        33722667,
                        33722699,
                        33722429,
                        33722121,
                        33722646
                    ],
                    "score": 118,
                    "time": 1669222863,
                    "title": "Wasmer 3.0",
                    "type": "story",
                    "url": "https://wasmer.io/posts/announcing-wasmer-3.0"
                },
                {
                    "by":
                        "WallyFunk",
                    "descendants":
                        19,
                    "id":
                        33722282,
                    "kids":
                        [
                            33724115,
                            33723991,
                            33723709,
                            33724141,
                            33723813,
                            33723879,
                            33724057,
                            33723974,
                            33723620
                        ],
                    "score":
                        88,
                    "time":
                        1669225671,
                    "title":
                        "Valve Introduces Proton Next",
                    "type":
                        "story",
                    "url":
                        "https://linuxgamingcentral.com/posts/valve-introduces-proton-next/"
                }
                ,
                {
                    "by":
                        "Ostatnigrosh",
                    "descendants":
                        33,
                    "id":
                        33722494,
                    "kids":
                        [
                            33723127,
                            33724073,
                            33722495,
                            33723404,
                            33722981,
                            33723099,
                            33723542,
                            33723417,
                            33723967,
                            33723135,
                            33722799,
                            33722780
                        ],
                    "score":
                        67,
                    "time":
                        1669226717,
                    "title":
                        "Show HN: I built an app that scans every social media network for your username",
                    "type":
                        "story",
                    "url":
                        "https://www.handlefinder.com/"
                }
                ,
                {
                    "by":
                        "brandrick",
                    "descendants":
                        52,
                    "id":
                        33718508,
                    "kids":
                        [
                            33724154,
                            33724061,
                            33718603,
                            33719712,
                            33722228,
                            33722650,
                            33720102,
                            33719453,
                            33719479,
                            33722901,
                            33721244,
                            33719820,
                            33722200,
                            33721269,
                            33722244,
                            33721725,
                            33722392,
                            33721267,
                            33722505,
                            33719488,
                            33723273,
                            33723432
                        ],
                    "score":
                        409,
                    "time":
                        1669207647,
                    "title":
                        "An interactive guide to Flexbox",
                    "type":
                        "story",
                    "url":
                        "https://www.joshwcomeau.com/css/interactive-guide-to-flexbox/"
                }
                ,
                {
                    "by":
                        "embit",
                    "descendants":
                        45,
                    "id":
                        33722862,
                    "kids":
                        [
                            33723694,
                            33723877,
                            33723596,
                            33724031,
                            33723400,
                            33724125,
                            33723477,
                            33723867,
                            33723205,
                            33723535,
                            33724106,
                            33723896,
                            33723968,
                            33724100,
                            33724065,
                            33723807,
                            33723713,
                            33723473,
                            33723741,
                            33723749,
                            33723747,
                            33723558,
                            33723323,
                            33723480,
                            33723891,
                            33723638
                        ],
                    "score":
                        109,
                    "time":
                        1669228367,
                    "title":
                        "Last.fm turns 20",
                    "type":
                        "story",
                    "url":
                        "https://www.theverge.com/2022/11/22/23473358/lastfm-discord-bot-neil-young-spotify"
                }
                ,
                {
                    "by":
                        "TangerineDream",
                    "descendants":
                        162,
                    "id":
                        33720602,
                    "kids":
                        [
                            33721068,
                            33723721,
                            33723805,
                            33722380,
                            33722064,
                            33721332,
                            33723095,
                            33722174,
                            33724098,
                            33722059,
                            33722703,
                            33723824,
                            33723977,
                            33723908,
                            33723642,
                            33723808,
                            33722534,
                            33723131,
                            33723337,
                            33723884,
                            33723728,
                            33723591,
                            33723140,
                            33722284,
                            33722297,
                            33722912,
                            33722447,
                            33721558,
                            33723206,
                            33722910,
                            33723361,
                            33723646,
                            33722192,
                            33723320,
                            33721756,
                            33721923,
                            33722768,
                            33721277,
                            33723449,
                            33721126,
                            33723090,
                            33722583,
                            33722283,
                            33722208,
                            33721607,
                            33721666,
                            33723000,
                            33722352,
                            33723297,
                            33723636,
                            33721758,
                            33720790,
                            33722001,
                            33722497,
                            33722312,
                            33722386,
                            33722916,
                            33722529,
                            33723112,
                            33721052,
                            33722384,
                            33722359,
                            33722246,
                            33723655,
                            33721482,
                            33721471,
                            33721373,
                            33721352,
                            33723287,
                            33721134
                        ],
                    "score":
                        252,
                    "time":
                        1669218315,
                    "title":
                        "Writing by hand is still the best way to retain information",
                    "type":
                        "story",
                    "url":
                        "https://stackoverflow.blog/2022/11/23/why-writing-by-hand-is-still-the-best-way-to-retain-information/"
                }
                ,
                {
                    "by":
                        "xrayarx",
                    "descendants":
                        34,
                    "id":
                        33703192,
                    "kids":
                        [
                            33723463,
                            33724052,
                            33724078,
                            33723391,
                            33723790,
                            33723907,
                            33723486,
                            33723419
                        ],
                    "score":
                        47,
                    "time":
                        1669103534,
                    "title":
                        "Being OK with not being extraordinary (2021)",
                    "type":
                        "story",
                    "url":
                        "https://www.tiffanymatthe.com/not-extraordinary"
                }
                ,
                {
                    "by":
                        "codazoda",
                    "descendants":
                        2,
                    "id":
                        33721314,
                    "kids":
                        [
                            33724143,
                            33723421
                        ],
                    "score":
                        73,
                    "time":
                        1669221197,
                    "title":
                        "Diátaxis: A systematic framework for technical documentation authoring",
                    "type":
                        "story",
                    "url":
                        "https://diataxis.fr/"
                }
                ,
                {
                    "by":
                        "phgn",
                    "descendants":
                        17,
                    "id":
                        33718850,
                    "kids":
                        [
                            33723850,
                            33718859,
                            33723782,
                            33723650,
                            33724039,
                            33722460,
                            33721591,
                            33720260
                        ],
                    "score":
                        33,
                    "text":
                        "Hey everyone!<p>In the last months I&#x27;ve been working on Unclutter, a modern reader mode browser extension. In contrast to all existing approaches, it unclutters articles by modifying their CSS instead of extracting the text content.<p>This results in a more visually pleasing result that reuses the original article style. The idea is to remove friction so you use the reader mode more often.\nThere are a few more features around saving articles automatically and taking highlights -- more details are on the website.<p>The extension has about 400 active weekly users right now, mostly from organic web store traffic. Monetisation has proven to be hard and for freemium there would need to be much higher numbers anyways.\nDo you think I should keep working on the project?",
                    "time":
                        1669210125,
                    "title":
                        "Show HN: Unclutter – Reader mode, but better",
                    "type":
                        "story",
                    "url":
                        "https://unclutter.it"
                }
                ,
                {
                    "by":
                        "trizoza",
                    "descendants":
                        116,
                    "id":
                        33718124,
                    "kids":
                        [
                            33719726,
                            33722893,
                            33718331,
                            33718675,
                            33720082,
                            33718237,
                            33723865,
                            33719646,
                            33718737,
                            33718907,
                            33719202,
                            33718756,
                            33718315,
                            33720267,
                            33723469,
                            33720396,
                            33718788,
                            33718394,
                            33718612,
                            33722251,
                            33720349,
                            33719503,
                            33719001,
                            33720990,
                            33722626,
                            33719802,
                            33719229,
                            33722422,
                            33718438,
                            33718911,
                            33719446,
                            33719695,
                            33718577,
                            33720246,
                            33720487,
                            33718428,
                            33718562,
                            33719392,
                            33719590,
                            33718847,
                            33720515,
                            33718487,
                            33719369,
                            33719518,
                            33718413,
                            33718335,
                            33719287,
                            33722161,
                            33719374,
                            33719461,
                            33719612,
                            33720358,
                            33718798,
                            33718949,
                            33720196,
                            33718953,
                            33719748,
                            33720217,
                            33719904
                        ],
                    "score":
                        413,
                    "text":
                        "I had the concept in my head for some time and firstly just prototyped it using only HTML &amp; CSS. Sent it to a few friends and they liked it so I made it into its own website and added few &#x27;competitive&#x27; features like click counter and share button.",
                    "time":
                        1669205011,
                    "title":
                        "Show HN: I made a pretty relaxing puzzle game",
                    "type":
                        "story",
                    "url":
                        "https://rotaboxes.com"
                }
                ,
                {
                    "by":
                        "prmph",
                    "descendants":
                        221,
                    "id":
                        33718202,
                    "kids":
                        [
                            33719721,
                            33719143,
                            33724068,
                            33719725,
                            33719150,
                            33719477,
                            33723587,
                            33719313,
                            33719512,
                            33718670,
                            33719127,
                            33722449,
                            33720172,
                            33719185,
                            33723296,
                            33719357,
                            33719682,
                            33720745,
                            33721298,
                            33719404,
                            33722390,
                            33721249,
                            33722141,
                            33720825,
                            33720376,
                            33719123,
                            33719903,
                            33719217,
                            33719290,
                            33719773,
                            33720211,
                            33720590,
                            33720526,
                            33721815,
                            33719188,
                            33719630,
                            33719368,
                            33719279,
                            33719325,
                            33720332,
                            33719828,
                            33719586,
                            33719261
                        ],
                    "score":
                        213,
                    "time":
                        1669205532,
                    "title":
                        "“Invalid Username or Password”: a useless security measure (2014)",
                    "type":
                        "story",
                    "url":
                        "https://kevin.burke.dev/kevin/invalid-username-or-password-useless/"
                }
                ,
                {
                    "by":
                        "gkoberger",
                    "id":
                        33721693,
                    "score":
                        1,
                    "time":
                        1669222896,
                    "title":
                        "ReadMe (YC W15) is hiring a product manager who loves APIs",
                    "type":
                        "job",
                    "url":
                        "https://readme.com/careers#product-lead"
                }
            ];
    const url = "topstories";
    axios.get.mockResolvedValueOnce(mockData);
    const {getAllByTestId, getByText, findAllByTestId} = render(<ArticleList urlParams={url}/>);
    expect(getByText(/Loading/i)).toBeInTheDocument();

    //check what's rendered in the row
    const rowValues = await findAllByTestId("story-list");
    expect(rowValues).toBeInTheDocument();
    // expect(axios.get).toHaveBeenCalledWith(url);
    // expect(axios.get).toHaveBeenCalledTimes(1);
})